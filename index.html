<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>reAlBhed - Realtime Al Bhed Translator</title>
  <link href='http://fonts.googleapis.com/css?family=Sonsie+One|Arapey' rel='stylesheet' type='text/css'>
  <link href="style.css" rel="stylesheet">
  <script>
    window.onload = function() {
      var input  = document.getElementById("input");
      var output = document.getElementById("output");
      var engbutton = document.getElementById("english");
      var albutton = document.getElementById("alBhed");
      var title = document.getElementById("title");
      var subtitle = document.getElementById("subtitle");
      var primers = document.getElementsByClassName("primer");
      var primed = new Array();
      var engalpha = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
      var albalpha = "ypltavkrezgmshubxncdijfqowYPLTAVKREZGMSHUBXNCDIJFXOW";

      //focus on textbox on load
      input.focus();
      loadPrimers();

      //checks if the cookie is set and transfers the data to primed if it is
      function loadPrimers() {
        if (!(document.cookie.indexOf('savedprimers') == -1)) {
          var cookies = document.cookie.split(';');
          for (var x = 0; x < cookies.length; x++) {
            if (!(cookies[x].indexOf('savedprimers') == -1)) {
              var cookiestring = cookies[x];
            }
          }
          cookiestring = cookiestring.substring(cookiestring.indexOf('=') + 1, cookiestring.length);
          primed = cookiestring.split(',');
          //converts primed to integers, then checks the stored boxes
          for (var y = 0; y < primed.length; y++) {
            primed[y] = parseInt(primed[y]);
            if (primed[y] < 26) {
              document.getElementById(primed[y]).checked = true;
            }
          }
        }
      }

      //create control function for each primer
      for (var i = 0; i < primers.length; i++) {
        primers[i].onclick = function() {
          document.getElementById("save").innerHTML = "Save Primers";
          //on primer click, if primer id not in array, add it
          if (primed.indexOf(parseInt(this.id)) == -1) {
            primed.push(parseInt(this.id));
            primed.push(parseInt(this.id) + 26);
          //otherwise, remove it
          } else {
            primed.splice(primed.indexOf(parseInt(this.id)),1);
            primed.splice(primed.indexOf(parseInt(this.id) + 26),1);
          }
          //then retranslate
          if (engbutton.checked) {
            output.innerHTML = translate(input.value, "english");
          } else if (albutton.checked) {
            output.innerHTML = translate(input.value, "alBhed");
          } 
        }
      }
      
      //english to al bhed translation function
      function translate(stringin, from) {
        var stringout = "";
        var flag = new Boolean(true);
        //for each item in the input string
        for (var i = 0; i < stringin.length; i++) {
          //check if it's an english letter
          if (engalpha.indexOf(stringin[i]) == -1) {
            //if not alpha, check whether to start ignoring translation
            if (stringin[i] == '[') {
              flag = false;
            //or stop ignoring translation
            } else if (stringin[i] == ']') {
              flag = true;
            //otherwise, add the non-alpha character to the output string
            } else {
              stringout = stringout + stringin[i];
            }
          //if alpha, check whether translation is being ignored
          } else if (flag == false) {
            //add character without translation if it is 
            stringout = stringout + "<span class='ignore'>" + stringin[i] + "</span>";
          } else {
            //or translate, then add if it isn't
            if (from == "english") {
              stringout = stringout + albalpha.charAt(engalpha.indexOf(stringin[i]));
            } else if (from == "alBhed") {
              //check if the character has been translated already by primer, and mark it if so
              if (primed.indexOf(engalpha.indexOf(stringin[i])) == -1) {
                stringout = stringout + engalpha.charAt(albalpha.indexOf(stringin[i]));
              } else {
                stringout = stringout + "<span class='primed'>" + stringin[i] + "</span>";
              }
            }
          }
        }
        return stringout;
      }

      //at the end of each keypress
      input.onkeyup = function() {
        //check which translation mode is selected, and translate
        if (engbutton.checked) {
          output.innerHTML = translate(input.value, "english");
        } else if (albutton.checked) {
          output.innerHTML = translate(input.value, "alBhed");
        } 
      }

      //retranslate on radio button click, and change title for effect
      engbutton.onclick = function() {
        output.innerHTML = translate(input.value, "english");
        title.innerHTML = "reAlBhed - Realtime Al Bhed Translator";
      }

      //as above, so below
      albutton.onclick = function() {
        output.innerHTML = translate(input.value, "alBhed");
        title.innerHTML = "reAlBhed - Naymdesa Al Bhed Dnyhcmydun";
      }

      //saves the selected primers to the cookie as 'savedprimers'
      save.onclick = function() {
        document.getElementById("save").innerHTML = "Saved!";
        document.cookie = 'savedprimers=;expires=Thu, 01 Jan 1970 00:00:01 GMT;';
        document.cookie = "savedprimers=" + primed;
      }

      //deletes the cookie and resets the selected primers
      reset.onclick = function() {
        document.cookie = 'savedprimers=;expires=Thu, 01 Jan 1970 00:00:01 GMT;';
        document.getElementById("save").innerHTML = "Save primers";
        for (var z = 0; z < 26; z++) {
          document.getElementById(z).checked = false;
        }
      }
    };
  </script>
</head>
<body>
  <?php include_once("../../analyticstracking.php") ?>
  <div class="container">
    <h1 id="title">reAlBhed - Realtime Al Bhed Translator</h1>
    <h2 class="subtitle">Use square brackets to [<span class="ignore">stop translation</span>]</h2>
    <textarea id="input" class="box"></textarea><br>
    <input type="radio" name="language" id="alBhed" value="Al Bhed -> English" checked>
    <label for="alBhed"><span></span>Al Bhed -> English</label>
    <input type="radio" name="language" id="english" value="English -> Al Bhed">
    <label for="english"><span></span>English -> Al Bhed</label>
    <p id="output" class="box"></p>
    <h2 class="subtitle">Choose any primers you <span class="primed">already have</span>.</h2>
    <table>
      <tr>
        <td><input type="checkbox" class="primer" id="0"><label for="0">I</label></td>
        <td><input type="checkbox" class="primer" id="1"><label for="1">II</label></td>
        <td><input type="checkbox" class="primer" id="2"><label for="2">III</label></td>
        <td><input type="checkbox" class="primer" id="3"><label for="3">IV</label></td>
        <td><input type="checkbox" class="primer" id="4"><label for="4">V</label></td>
        <td><input type="checkbox" class="primer" id="5"><label for="5">VI</label></td>
      </tr>
      <tr>
        <td><input type="checkbox" class="primer" id="6"><label for="6">VII</label></td>
        <td><input type="checkbox" class="primer" id="7"><label for="7">VIII</label></td>
        <td><input type="checkbox" class="primer" id="8"><label for="8">IX</label></td>
        <td><input type="checkbox" class="primer" id="9"><label for="9">X</label></td>
        <td><input type="checkbox" class="primer" id="10"><label for="10">XI</label></td>
        <td><input type="checkbox" class="primer" id="11"><label for="11">XII</label></td>
      </tr>
      <tr>
        <td><input type="checkbox" class="primer" id="12"><label for="12">XIII</label></td>
        <td><input type="checkbox" class="primer" id="13"><label for="13">XIV</label></td>
        <td><input type="checkbox" class="primer" id="14"><label for="14">XV</label></td>
        <td><input type="checkbox" class="primer" id="15"><label for="15">XVI</label></td>
        <td><input type="checkbox" class="primer" id="16"><label for="16">XVII</label></td>
        <td><input type="checkbox" class="primer" id="17"><label for="17">XVIII</label></td>
      </tr>
      <tr>
        <td><input type="checkbox" class="primer" id="18"><label for="18">XIX</label></td>
        <td><input type="checkbox" class="primer" id="19"><label for="19">XX</label></td>
        <td><input type="checkbox" class="primer" id="20"><label for="20">XXI</label></td>
        <td><input type="checkbox" class="primer" id="21"><label for="21">XXII</label></td>
        <td><input type="checkbox" class="primer" id="22"><label for="22">XXIII</label></td>
        <td><input type="checkbox" class="primer" id="23"><label for="23">XXIV</label></td>
      </tr>
      <tr>
        <td></td>
        <td><input type="checkbox" class="primer" id="24"><label for="24">XXV</label></td>
        <td></td>
        <td></td>
        <td><input type="checkbox" class="primer" id="25"><label for="25">XXVI</label></td>
        <td></td>
      </tr>
      <tr class="spacer"></tr>
      <tr>
        <td colspan="3"><button id="save">Save Primers</button></td>
        <td colspan="3"><button id="reset">Reset</button></td>
      </tr>
    </table>
    <br><br>
    <p id="footer">Created by <a href="http://chrisdbrown.co.uk">Chris D Brown</a></p>
  </div>
</body>
</html>